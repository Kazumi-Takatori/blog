---
title: >
    Exchange 2013/2016 のセーフティネットの保存期間
date: 2017-01-25
tags: Exchange
---

Exchange 2013/2016 を、Exchange 2010 など以前のバージョンとの混在環境で運用する場合の注意点をご案内します。

以下の TechNet の情報のとおり、セーフティ ネットの既定の保存期間は 2 日です。

  セーフティ ネット  
  https://technet.microsoft.com/ja-jp/library/jj657495(v=exchg.150).aspx

この期間は、Exchange 管理シェルで

```PowerShell
Get-TransportConfig | fl SafeteyNetHoldTime
```

を実行することで確認することができます。

しかし、この値を既定値から変更している環境で、累積的な更新プログラムをインストールする際に既定の 2 日にリセットされてしまう問題が報告されたため、Exchange 2013 CU9 および Exchange 2016 では、Exchange 組織への新規インストール時は 2 日という値を設定し、既存のサーバーを更新する場合は、既に設定されている値を書き換えないようにインストーラーの動作が変更されています。

ここで注意していただきたいのは、「既存のサーバーの更新」の解釈です。既に Exchange 2010 や 2007 といった下位バージョンの Exchange Server を運用している環境に最初の Exchange 2013/2016 を追加インストールする場合も、スキーマ拡張や Exchange 組織の設定値の更新といった、Exchange 組織全体に関わる設定の更新においては、新規インストールではなく既存サーバーの更新として処理されます。
ご存知のように、Exchange 2013/2016 は 3 ヶ月ごとに累積的な更新プログラム (CU) という形で修正プログラムが提供されており、従来の更新プログラムのロールアップ (RU) のようにベースとなる RTM や SP 版をインストールしてから最新バージョンに更新しなくても最新の CU だけでインストールすることができます。ですが、前述のインストーラーの変更によって、Exchange 2013 CU9/Exchange 2016 RTM 以降のバージョンを Exchange 2007/2010 と共存させるためにインストールすると、SafetyNetHoldTime の値の初期化を防ぐ動作により、トランスポート設定の SafetyNetHoldTime の値 (AD の Transport Settings コンテナの msExchDumpsterHoldTime 属性に対応しています) が更新されずにそのままとなり、この結果、トランスポート サービスは Exchange Server のコードに内部的にハードコードされた既定値の 7 日を使用します。

この期間を変更せずに使用しますと、トランスポートのキュー データベースがセーフティ ネットのための複製メッセージのコピーを 7 日分貯め続けることになり、データベースがディスクを圧迫する場合があります。そのため、Exchange 2013 CU9/Exchange 2016 RTM 以降を使用してインストールした環境をお使いのお客様は、一度トランスポート設定の SafetyNetHoldTime を確認し、7 日に設定されているようでしたら、

```PowerShell
Set-TransportConfig -SafetyNetHoldTime 2.00:00:00
```

を実行し、セーフティネットの保持期間を既定の 2 日に設定してください。

 
※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。